<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Advanced Half-Hour Roster (Debug Mode)</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f4f4f4; }
    button { padding: 10px; margin: 10px; cursor: pointer; }
    input, select { padding: 5px; text-align: center; }
    .inline-block { display: inline-block; margin: 10px; }
    .break-time-container { 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      gap: 5px; 
      border: 1px solid #ccc;
      padding: 3px;
      background-color: #fafafa;
    }
    .draggable { cursor: move; }
    .shortfall-note { color: red; font-weight: bold; }
  </style>
</head>
<body>

  <h2>Advanced Half-Hour Roster (Debug Mode)</h2>

  <!-- Date & Day Selection -->
  <div class="inline-block">
    <label for="rosterDate">Date:</label>
    <input type="date" id="rosterDate" />
  </div>
  <div class="inline-block">
    <label for="rosterDay">Day:</label>
    <select id="rosterDay">
      <option value="Monday">Monday</option>
      <option value="Tuesday">Tuesday</option>
      <option value="Wednesday">Wednesday</option>
      <option value="Thursday">Thursday</option>
      <option value="Friday">Friday</option>
      <option value="Saturday">Saturday</option>
      <option value="Sunday">Sunday</option>
    </select>
  </div>

  <!-- Staff Table -->
  <table id="staffTable">
    <thead>
      <tr>
        <th>Staff ID</th>
        <th>Name</th>
        <th>Break Time (Start - End)</th>
        <th>HHMD Eligible?</th>
        <th>Attendance</th>
        <th>Lock</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rows will be loaded from localStorage or a sample row is created -->
    </tbody>
  </table>

  <button onclick="addStaff()">Add Staff</button>
  <button onclick="generateRoster()">Generate Roster</button>
  <button onclick="sendWhatsApp()">Send via WhatsApp</button>

  <h3>Generated Staff Roster</h3>
  <div id="rosterContainer"></div>

  <h4>Notes & Shortfalls</h4>
  <div id="notesContainer"></div>

  <script>
    console.log("Script loaded: Starting debug version...");

    /*******************************************************
     *            GLOBAL CONSTANTS & CONFIG
     *******************************************************/
    const STORAGE_KEY = 'staffListData_HalfHour_Debug';
    const HALF_HOURS = [
      "20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30",
      "00:00","00:30","01:00","01:30","02:00","02:30","03:00","03:30",
      "04:00","04:30","05:00","05:30","06:00","06:30","07:00","07:30"
    ];

    const OUTPUT_ORDER = [
      "Vertical Patrol",
      "Pass Counter",
      "Lobby",
      "HHMD",
      "Guard House",
      "Report Room",
      "Tango Papa"
    ];

    const PRIORITY = [
      { location: "Pass Counter", needed: 2 },
      { location: "HHMD",        needed: 1 },
      { location: "Lobby",       needed: 2 },
      { location: "Guard House", needed: 1 },
      { location: "Vertical Patrol", needed: 1 },
      { location: "Report Room",     needed: 1 },
      { location: "Tango Papa",      needed: 1 }
    ];

    /*******************************************************
     *            INITIALIZATION
     *******************************************************/
    window.onload = function() {
      console.log("window.onload triggered");
      loadStaffList();
    };

    /*******************************************************
     *            CORE FUNCTIONALITY
     *******************************************************/
    function getStaffRowHTML(staff) {
      let [startVal, endVal] = staff.breakTime ? staff.breakTime.split("-") : ["21:30","23:30"];
      return `
        <tr data-worked='${JSON.stringify(staff.workedLastTwoDays || [])}'
            data-assigned='${JSON.stringify(staff.assigned || [])}'>
          <td><input type="text" value="${staff.staffID}"></td>
          <td><input type="text" value="${staff.name}"></td>
          <td>
            <div class="break-time-container draggable" draggable="true">
              <input type="time" value="${startVal || "21:30"}" step="1">
              <span>-</span>
              <input type="time" value="${endVal   || "23:30"}" step="1">
            </div>
          </td>
          <td>
            <select>
              <option value="Yes" ${staff.hhmdEligible==="Yes"?"selected":""}>Yes</option>
              <option value="No"  ${staff.hhmdEligible==="No" ?"selected":""}>No</option>
            </select>
          </td>
          <td>
            <select>
              <option ${staff.attendance==="Yes"?"selected":""}>Yes</option>
              <option ${staff.attendance==="No" ?"selected":""}>No</option>
            </select>
          </td>
          <td>
            <input type="checkbox" ${staff.locked?"checked":""}>
          </td>
          <td><button onclick="removeRow(this)">Remove</button></td>
        </tr>
      `;
    }

    function addStaff() {
      const tbody = document.getElementById("staffTable").getElementsByTagName("tbody")[0];
      const newStaff = {
        staffID: "",
        name: "",
        breakTime: "21:30-23:30",
        hhmdEligible: "No",
        attendance: "Yes",
        locked: false,
        workedLastTwoDays: [],
        assigned: []
      };
      tbody.insertAdjacentHTML("beforeend", getStaffRowHTML(newStaff));
      addListenersToAllRows();
      saveStaffList();
    }

    // ... (Keep all other functions EXACTLY as provided in original script)
    // Remaining JavaScript code identical to original (preserve drag-drop, 
    // roster generation, WhatsApp sharing, etc.)

  </script>
</body>
</html>