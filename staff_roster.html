<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Refined Roster: HHMD at Top of Hour, No Consecutive Use, No Repeat Vertical Patrol</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
    }
    header {
      background-color: #f5f5f5;
      padding: 15px;
      border-bottom: 1px solid #ddd;
    }
    h2 {
      margin: 0;
      text-align: center;
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 15px;
    }
    .top-bar label {
      font-weight: bold;
    }
    .top-bar input[type="date"],
    .top-bar select {
      padding: 5px;
      text-align: center;
    }

    /* Button styling */
    .button-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 15px;
    }
    button {
      background-color: #0066cc;
      color: #fff;
      padding: 10px 20px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
    }
    button:hover {
      background-color: #004a99;
    }

    /* Stats row (Coverage, Optimization Score, Staff Utilization) */
    .stats-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .stat-box {
      background-color: #fafafa;
      border: 1px solid #ccc;
      border-radius: 6px;
      width: 200px;
      padding: 15px;
      text-align: center;
    }
    .stat-box h4 {
      margin: 0 0 10px;
      font-size: 1.1rem;
    }
    .stat-box p {
      font-size: 1.4rem;
      margin: 0;
      font-weight: bold;
    }

    /* Staff Table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #f4f4f4;
    }

    /* Break time container for drag-and-drop */
    .break-time-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      border: 1px solid #ccc;
      padding: 3px;
      background-color: #fafafa;
    }
    .draggable {
      cursor: move;
    }

    /* Notes */
    .shortfall-note {
      color: red;
      font-weight: bold;
    }

    /* Roster table */
    #rosterContainer table {
      margin-top: 20px;
    }
  </style>
</head>
<body>

<header>
  <h2>Refined Roster (No Lock, Round-Robin, Strict Rules)</h2>
</header>

<!-- Date & Day Selection -->
<div class="top-bar">
  <div>
    <label for="rosterDate">Date:</label>
    <input type="date" id="rosterDate">
  </div>
  <div>
    <label for="rosterDay">Day:</label>
    <select id="rosterDay">
      <option value="Monday">Monday</option>
      <option value="Tuesday">Tuesday</option>
      <option value="Wednesday">Wednesday</option>
      <option value="Thursday">Thursday</option>
      <option value="Friday">Friday</option>
      <option value="Saturday">Saturday</option>
      <option value="Sunday">Sunday</option>
    </select>
  </div>
</div>

<!-- Button bar -->
<div class="button-bar">
  <button type="button" onclick="addStaff()">Add Staff</button>
  <button type="button" onclick="generateRoster()">Generate Roster</button>
  <button type="button" onclick="optimizeRoster()">Optimize</button>
  <button type="button" onclick="validateRoster()">Validate</button>
  <button type="button" onclick="exportStaffData()">Export</button>
  <button type="button" onclick="document.getElementById('importFile').click()">Import</button>
  <button type="button" onclick="sendWhatsApp()">Share</button>
  <input type="file" id="importFile" accept=".json" onchange="importStaffData(event)" style="display:none;">
</div>

<!-- Stats row -->
<div class="stats-row">
  <div class="stat-box">
    <h4>Coverage</h4>
    <p id="coverage">-</p>
  </div>
  <div class="stat-box">
    <h4>Optimization Score</h4>
    <p id="optimizationScore">-</p>
  </div>
  <div class="stat-box">
    <h4>Staff Utilization</h4>
    <p id="staffUtilization">-</p>
  </div>
</div>

<!-- Staff Table -->
<table id="staffTable">
  <thead>
    <tr>
      <th>Staff ID</th>
      <th>Name</th>
      <th>Break Time (Start - End)</th>
      <th>HHMD Eligible?</th>
      <th>Attendance</th>
      <th>Constraints</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <!-- Staff rows will be inserted here -->
  </tbody>
</table>

<!-- Generated Roster -->
<h3 style="margin-top: 30px;">Generated Roster</h3>
<div id="rosterContainer"></div>

<h4>Notes & Shortfalls</h4>
<div id="notesContainer"></div>

<script>
  /*******************************************************
   * GLOBAL CONSTANTS & CONFIG
   *******************************************************/
  const STORAGE_KEY = 'staffListData_StrictRules_Debug';

  // Full half-hour increments from 20:00 to 07:30 (for internal logic)
  const TIME_SLOTS = [
    "20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30",
    "00:00","00:30","01:00","01:30","02:00","02:30","03:00","03:30",
    "04:00","04:30","05:00","05:30","06:00","06:30","07:00","07:30"
  ];

  // Displayed slots (trimmed)
  const DISPLAY_SLOTS = [
    "20:00","20:30","21:00","22:00","23:00",
    "00:00","01:00","01:30","02:00","03:00",
    "04:00","05:00","06:00","06:30","07:00","07:30"
  ];

  // Locations in display order
  const OUTPUT_ORDER = [
    "HHMD",
    "Guard House",
    "Lobby",
    "Pass Counter",
    "Vertical Patrol",
    "Report Room",
    "Tango Papa"
  ];

  // Priority for assignment
  const PRIORITY = [
    { location: "HHMD", needed: 1 },
    { location: "Guard House", needed: 1 },
    { location: "Lobby", needed: 2 },
    { location: "Pass Counter", needed: 2 },
    { location: "Vertical