<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Roster</title>
  <style>
    /* [Keep the original CSS styles here] */
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header { background-color: #f5f5f5; padding: 15px; border-bottom: 1px solid #ddd; text-align: center; }
    /* ... (Include all CSS from the original script) ... */
  </style>
</head>
<body>
  <header>
    <h2>Daily Roster</h2>
  </header>
  <div class="content">
    <!-- [Keep all HTML elements from the original script] -->
    <div class="top-bar">
      <div>
        <label for="rosterDate">Date:</label>
        <input type="date" id="rosterDate">
      </div>
      <div>
        <label for="rosterDay">Day:</label>
        <select id="rosterDay">
          <option value="Monday">Monday</option>
          <option value="Tuesday">Tuesday</option>
          <option value="Wednesday">Wednesday</option>
          <option value="Thursday">Thursday</option>
          <option value="Friday">Friday</option>
          <option value="Saturday">Saturday</option>
          <option value="Sunday">Sunday</option>
        </select>
      </div>
    </div>
    <div class="button-bar">
      <button type="button" onclick="addStaff()">Add Staff</button>
      <button type="button" onclick="exportStaffData()">Export</button>
      <button type="button" onclick="document.getElementById('importFile').click()">Import</button>
      <input type="file" id="importFile" accept=".json" style="display:none;">
    </div>
    <div class="stats-row">
      <div class="stat-box">
        <h4>Coverage</h4>
        <p id="coverage">-</p>
      </div>
      <div class="stat-box">
        <h4>Optimization Score</h4>
        <p id="optimizationScore">-</p>
      </div>
      <div class="stat-box">
        <h4>Total Headcount</h4>
        <p id="staffUtilization">-</p>
      </div>
    </div>
    <table id="staffTable">
      <thead>
        <tr>
          <th>Staff ID</th>
          <th>Name</th>
          <th>Break Time</th>
          <th>HHMD Eligible?</th>
          <th>Attendance</th>
          <th>Constraints</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="roster-header">
      <h3>Generated Roster</h3>
      <button type="button" onclick="generateRoster()">Generate Roster</button>
      <button type="button" onclick="copyTSV()">Copy Roster TSV</button>
    </div>
    <div id="rosterContainer"></div>
    <h4>Notes & Shortfalls</h4>
    <div id="notesContainer"></div>
  </div>

  <!-- JavaScript Fixes -->
  <script>
    // ... (Replace the entire <script> block with the code below) ...
    const STORAGE_KEY = 'staffListData_StrictRules_Debug';
    const TIME_SLOTS = ["20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30","00:00","00:30","01:00","01:30","02:00","02:30","03:00","03:30","04:00","04:30","05:00","05:30","06:00","06:30","07:00","07:30"];
    const DISPLAY_SLOTS = ["20:00","20:30","21:00","22:00","23:00","00:00","01:00","01:30","02:00","03:00","04:00","05:00","06:00","06:30","07:00","07:30"];
    const OUTPUT_ORDER = ["HHMD","Guard House","Lobby","Pass Counter","Vertical Patrol","Report Room","Tango Papa"];
    const PRIORITY = [
      { location: "HHMD", needed: 1 },
      { location: "Guard House", needed: 1 },
      { location: "Lobby", needed: 2 },
      { location: "Pass Counter", needed: 2 },
      { location: "Vertical Patrol", needed: 1 },
      { location: "Report Room", needed: 1 },
      { location: "Tango Papa", needed: 1 }
    ];
    let lastRoster = null;

    // Initialize on load
    window.onload = function() {
      loadStaffList();
      document.getElementById('importFile').addEventListener('change', importStaffData);
    };

    // Load/Save Staff Data
    function loadStaffList() {
      const stored = localStorage.getItem(STORAGE_KEY);
      const tbody = document.querySelector("#staffTable tbody");
      if (stored) {
        try {
          const staffList = JSON.parse(stored);
          tbody.innerHTML = staffList.map(staff => getStaffRowHTML(staff)).join("");
        } catch (e) {
          console.error("Error loading staff data:", e);
          tbody.innerHTML = "";
        }
      } else {
        addStaff(); // Add default row
      }
      addDragAndDropListeners();
    }

    function saveStaffList() {
      const staffList = [];
      document.querySelectorAll("#staffTable tbody tr").forEach(row => {
        const staffID = row.querySelector("td:nth-child(1) input").value.trim();
        const name = row.querySelector("td:nth-child(2) input").value.trim();
        const breakStart = row.querySelector("td:nth-child(3) input[type='time']:nth-child(1)").value;
        const breakEnd = row.querySelector("td:nth-child(3) input[type='time']:nth-child(3)").value;
        const hhmdEligible = row.querySelector("td:nth-child(4) select").value;
        const attendance = row.querySelector("td:nth-child(5) select").value;
        const constraints = row.querySelector("td:nth-child(6) input").value.trim();
        staffList.push({ staffID, name, breakTime: `${breakStart}-${breakEnd}`, hhmdEligible, attendance, constraints });
      });
      localStorage.setItem(STORAGE_KEY, JSON.stringify(staffList));
    }

    // ... (Include the rest of the JavaScript functions from the original script, ensuring no syntax errors) ...
  </script>
</body>
</html>